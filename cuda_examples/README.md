# CUDA Examples

Here are the CUDA examples fromc class

 - [Call printf from GPU threads](https://lawlor.cs.uaf.edu/netrun/run?name=Testing&code=__global__%20void%20do_work%28%29%20%7B%0D%0A%09printf%28%22Hello%20from%20GPU%20thread%20%25d%20in%20block%20%25d%5Cn%22%2C%20threadIdx.x%2C%20blockIdx.x%29%3B%0D%0A%7D%0D%0A%0D%0Along%20foo%28%29%20%7B%0D%0A%09long%20blocks%20%3D%203%3B%0D%0A%09long%20blockSize%20%3D%205%3B%0D%0A%09%0D%0A%09do_work%3C%3C%3Cblocks%2CblockSize%3E%3E%3E%28%29%3B%0D%0A%09cudaDeviceSynchronize%28%29%3B%0D%0A%0D%0A%09return%200%3B%0D%0A%7D&lang=CUDA&mach=skylake64&mode=file&input=&linkwith=&foo_ret=long&foo_arg0=void&orun=Run&orun=Grade&ocompile=Optimize&ocompile=Warnings)
 - [Allocating memory on GPU and copying to CPU](https://lawlor.cs.uaf.edu/netrun/run?name=Testing&code=__global__%20void%20do_work%28long%2A%20results%29%20%7B%0D%0A%09long%20i%20%3D%20threadIdx.x%20%2B%20blockIdx.x%20%2A%20blockDim.x%3B%0D%0A%09results%5Bi%5D%20%3D%2010%2Ai%3B%0D%0A%7D%0D%0A%0D%0Along%20foo%28%29%20%7B%0D%0A%09long%20blocks%20%3D%203%3B%0D%0A%09long%20blockSize%20%3D%205%3B%0D%0A%09long%20size%20%3D%20blocks%20%2A%20blockSize%3B%0D%0A%09%0D%0A%09%2F%2F%20Create%20an%20array%20of%20longs%20in%20GPU%20memory%20to%20store%20thread%20results%0D%0A%09long%2A%20gpu_results%3B%0D%0A%09cudaMalloc%28%26gpu_results%2C%20size%20%2A%20sizeof%28long%29%29%3B%0D%0A%09%0D%0A%09%2F%2F%20Tell%20the%20GPU%20to%20spin%20up%20the%20given%20number%20of%20threads%20to%20run%20our%20GPU%20code%20do_work%0D%0A%09do_work%3C%3C%3Cblocks%2CblockSize%3E%3E%3E%28gpu_results%29%3B%0D%0A%09%0D%0A%09%2F%2F%20Wait%20for%20GPU%20code%20to%20finish%0D%0A%09cudaDeviceSynchronize%28%29%3B%0D%0A%0D%0A%09%2F%2F%20We%20create%20an%20array%20of%20the%20same%20size%20on%20the%20CPU%20and%20copy%20the%20memory%20over%0D%0A%09long%20cpu_results%5Bsize%5D%3B%0D%0A%09cudaMemcpy%28cpu_results%2C%20gpu_results%2C%20size%20%2A%20sizeof%28long%29%2C%20cudaMemcpyDeviceToHost%29%3B%0D%0A%09%0D%0A%09%2F%2F%20Print%20out%20results%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20size%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09std%3A%3Acout%20%3C%3C%20%22results%5B%22%20%3C%3C%20i%20%3C%3C%20%22%5D%20%3D%20%22%20%3C%3C%20cpu_results%5Bi%5D%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%7D%0D%0A%0D%0A%09return%200%3B%0D%0A%7D&lang=CUDA&mach=skylake64&mode=file&input=&linkwith=&foo_ret=long&foo_arg0=void&orun=Run&orun=Grade&ocompile=Optimize&ocompile=Warnings)
 - [Using Dr. Lawlor's gpu_vec class to allocate GPU memory](https://lawlor.cs.uaf.edu/netrun/run?name=Testing&code=%23include%20%22osl%2Fgpu_vec.h%22%0D%0A%0D%0A__global__%20void%20do_work%28long%2A%20results%29%20%7B%0D%0A%09long%20i%20%3D%20threadIdx.x%20%2B%20blockIdx.x%20%2A%20blockDim.x%3B%0D%0A%09results%5Bi%5D%20%3D%2010%2Ai%3B%0D%0A%7D%0D%0A%0D%0Along%20foo%28%29%20%7B%0D%0A%09long%20blocks%20%3D%203%3B%0D%0A%09long%20blockSize%20%3D%205%3B%0D%0A%09long%20size%20%3D%20blocks%20%2A%20blockSize%3B%0D%0A%09%0D%0A%09%2F%2F%20Create%20an%20array%20of%20longs%20in%20GPU%20memory%20to%20store%20thread%20results%0D%0A%09gpu_vec%3Clong%3E%20gpu_results%28size%29%3B%0D%0A%09%0D%0A%09%2F%2F%20Tell%20the%20GPU%20to%20spin%20up%20the%20given%20number%20of%20threads%20to%20run%20our%20GPU%20code%20do_work%0D%0A%09do_work%3C%3C%3Cblocks%2CblockSize%3E%3E%3E%28gpu_results%29%3B%0D%0A%09%0D%0A%09%2F%2F%20Wait%20for%20GPU%20code%20to%20finish%0D%0A%09cudaDeviceSynchronize%28%29%3B%0D%0A%0D%0A%09%2F%2F%20We%20create%20an%20array%20of%20the%20same%20size%20on%20the%20CPU%20and%20copy%20the%20memory%20over%0D%0A%09std%3A%3Avector%3Clong%3E%20cpu_results%28size%29%3B%0D%0A%09gpu_results.copy_to%28cpu_results%29%3B%0D%0A%0D%0A%09%2F%2F%20Print%20out%20results%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20size%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09std%3A%3Acout%20%3C%3C%20%22results%5B%22%20%3C%3C%20i%20%3C%3C%20%22%5D%20%3D%20%22%20%3C%3C%20cpu_results%5Bi%5D%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%7D%0D%0A%0D%0A%09return%200%3B%0D%0A%7D&lang=CUDA&mach=skylake64&mode=file&input=&linkwith=&foo_ret=long&foo_arg0=void&orun=Run&orun=Grade&ocompile=Optimize&ocompile=Warnings)
 - [Collatz benchmark on GPU](https://lawlor.cs.uaf.edu/netrun/run?name=example_cuda&code=%23include%20%22osl%2Fgpu_vec.h%22%0D%0A%0D%0Aenum%20%7B%20MAX_COUNT%20%3D%201000000%20%7D%3B%0D%0A%0D%0Along%20collatz_count%28long%20n%29%20%7B%0D%0A%09long%20count%20%3D%200%3B%0D%0A%09while%28n%20%21%3D%201%29%20%7B%0D%0A%09%09if%28n%20%25%202%20%3D%3D%200%29%20%7B%0D%0A%09%09%09n%20%3D%20n%20%2F%202%3B%0D%0A%09%09%7D%20else%20%7B%0D%0A%09%09%09n%20%3D%203%20%2A%20n%20%2B%201%3B%0D%0A%09%09%7D%0D%0A%09%09%2B%2Bcount%3B%0D%0A%09%7D%0D%0A%09return%20count%3B%0D%0A%7D%0D%0A%0D%0A__global__%20void%20do_work%28long%2A%20results%29%20%7B%0D%0A%09long%20i%20%3D%20threadIdx.x%20%2B%20blockIdx.x%20%2A%20blockDim.x%3B%0D%0A%09%0D%0A%09long%20n%20%3D%20i%20%2B%201%3B%0D%0A%09long%20count%20%3D%200%3B%0D%0A%09while%28n%20%21%3D%201%29%20%7B%0D%0A%09%09if%28n%20%25%202%20%3D%3D%200%29%20%7B%0D%0A%09%09%09n%20%3D%20n%20%2F%202%3B%0D%0A%09%09%7D%20else%20%7B%0D%0A%09%09%09n%20%3D%203%20%2A%20n%20%2B%201%3B%0D%0A%09%09%7D%0D%0A%09%09%2B%2Bcount%3B%0D%0A%09%7D%0D%0A%0D%0A%09results%5Bi%5D%20%3D%20count%3B%0D%0A%7D%0D%0A%0D%0Along%20foo%28%29%20%7B%0D%0A%09long%20blockSize%20%3D%20100%3B%0D%0A%09long%20blocks%20%3D%20MAX_COUNT%20%2F%20blockSize%3B%0D%0A%09%0D%0A%09gpu_vec%3Clong%3E%20results%28MAX_COUNT%29%3B%0D%0A%09%0D%0A%09double%20start%20%3D%20time_in_seconds%28%29%3B%0D%0A%09long%20runs%20%3D%204%3B%0D%0A%09for%28int%20i%20%3D%200%3B%20i%20%3C%20runs%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09do_work%3C%3C%3Cblocks%2CblockSize%3E%3E%3E%28results%29%3B%0D%0A%09%7D%0D%0A%09%0D%0A%09cudaError_t%20error%20%3D%20cudaPeekAtLastError%28%29%3B%20%2F%2F%20check%20if%20kernel%20launch%20worked%0D%0A%09if%20%28error%20%3D%3D%200%29%20error%20%3D%20cudaDeviceSynchronize%28%29%3B%20%2F%2F%20wait%20for%20GPU%20threads%20to%20finish%0D%0A%09if%20%28error%20%21%3D%200%29%20printf%28%22CUDA%20Error%20%25s%20%28%25d%29%22%2C%20cudaGetErrorString%28error%29%2C%20%28int%29error%29%3B%0D%0A%09%0D%0A%09double%20end%20%3D%20time_in_seconds%28%29%3B%0D%0A%09std%3A%3Acout%20%3C%3C%20%22Time%20per%20collatz%3A%20%22%20%3C%3C%20%28end%20-%20start%29%20%2A%201000.0%20%2A%201000.0%20%2A%201000.0%20%2F%20%28MAX_COUNT%20%2A%20runs%29%20%3C%3C%20%22ns%5Cn%22%3B%0D%0A%0D%0A%09std%3A%3Avector%3Clong%3E%20cpu_results%28MAX_COUNT%29%3B%0D%0A%09results.copy_to%28cpu_results%29%3B%0D%0A%09%0D%0A%09%2F%2F%20check%20to%20see%20that%20our%20compuation%20on%20GPU%20was%20correct%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09if%28cpu_results%5Bi%5D%20%21%3D%20collatz_count%28i%2B1%29%29%20%7B%0D%0A%09%09%09std%3A%3Acout%20%3C%3C%20%22error%3A%20c%5B%22%20%3C%3C%20i%20%3C%3C%20%22%5D%20%3D%20%22%20%3C%3C%20cpu_results%5Bi%5D%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%09%09break%3B%0D%0A%09%09%7D%0D%0A%09%7D%0D%0A%09%0D%0A%09return%200%3B%0D%0A%7D&lang=CUDA&mach=skylake64&mode=file&input=&linkwith=&foo_ret=long&foo_arg0=void&orun=Run&orun=Grade&ocompile=Optimize&ocompile=Warnings)
 - [Collatz benchmark on CPU](https://lawlor.cs.uaf.edu/netrun/run?name=example_cpp&code=enum%20%7B%20MAX_COUNT%20%3D%201000000%20%7D%3B%0D%0A%0D%0Along%20collatz_count%28long%20n%29%20%7B%0D%0A%09long%20count%20%3D%200%3B%0D%0A%09while%28n%20%21%3D%201%29%20%7B%0D%0A%09%09if%28n%20%25%202%20%3D%3D%200%29%20%7B%0D%0A%09%09%09n%20%3D%20n%20%2F%202%3B%0D%0A%09%09%7D%20else%20%7B%0D%0A%09%09%09n%20%3D%203%20%2A%20n%20%2B%201%3B%0D%0A%09%09%7D%0D%0A%09%09%2B%2Bcount%3B%0D%0A%09%7D%0D%0A%09return%20count%3B%0D%0A%7D%0D%0A%0D%0Along%20collatz_numbers%5BMAX_COUNT%5D%3B%0D%0A%0D%0Avoid%20foo%28%29%20%7B%0D%0A%09double%20start%20%3D%20time_in_seconds%28%29%3B%0D%0A%09%23pragma%20omp%20parallel%20for%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09collatz_numbers%5Bi%5D%20%3D%20collatz_count%28i%2B1%29%3B%0D%0A%09%7D%0D%0A%09double%20end%20%3D%20time_in_seconds%28%29%3B%0D%0A%09std%3A%3Acout%20%3C%3C%20%22Time%20per%20collatz%3A%20%22%20%3C%3C%20%28end%20-%20start%29%20%2A%201000.0%20%2A%201000.0%20%2A%201000.0%20%2F%20%28MAX_COUNT%29%20%3C%3C%20%22ns%5Cn%22%3B%0D%0A%09%2F%2Ffor%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%2F%2F%09std%3A%3Acout%20%3C%3C%20%28i%2B1%29%20%3C%3C%20%22%3A%20%22%20%3C%3C%20collatz_numbers%5Bi%5D%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%2F%2F%7D%0D%0A%7D&lang=C%2B%2B17&mach=skylake64&mode=file&input=&linkwith=&foo_ret=void&foo_arg0=void&orun=Run&orun=Grade&ocompile=Optimize&ocompile=Warnings)
