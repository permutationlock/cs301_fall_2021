# Thread Examples

Here are the thread examples fromc class

 - [Collatz with worker threads](https://lawlor.cs.uaf.edu/netrun/run?name=example_cpp&code=%23include%20%3Cqueue%3E%0D%0A%23include%20%3Cmutex%3E%0D%0A%23include%20%3Cthread%3E%0D%0A%23include%20%3Cutility%3E%0D%0A%0D%0Aenum%20%7B%20MAX_COUNT%20%3D%20100000%20%7D%3B%0D%0A%0D%0Along%20collatz_count%28long%20n%29%20%7B%0D%0A%09long%20count%20%3D%200%3B%0D%0A%09while%28n%20%21%3D%201%29%20%7B%0D%0A%09%09if%28n%20%25%202%20%3D%3D%200%29%20%7B%0D%0A%09%09%09n%20%3D%20n%20%2F%202%3B%0D%0A%09%09%7D%20else%20%7B%0D%0A%09%09%09n%20%3D%203%20%2A%20n%20%2B%201%3B%0D%0A%09%09%7D%0D%0A%09%09%2B%2Bcount%3B%0D%0A%09%7D%0D%0A%09return%20count%3B%0D%0A%7D%0D%0A%0D%0Avoid%20do_work%28long%2A%20collatz_numbers%2C%20std%3A%3Aqueue%3Cstd%3A%3Apair%3Clong%2C%20long%3E%20%3E%2A%20work%2C%20std%3A%3Amutex%2A%20lock%29%20%7B%0D%0A%09while%28true%29%20%7B%0D%0A%09%09std%3A%3Apair%3Clong%2C%20long%3E%20range%3B%0D%0A%09%09%7B%0D%0A%09%09%09std%3A%3Alock_guard%20guard%28%2Alock%29%3B%0D%0A%09%09%09if%28%21work-%3Eempty%28%29%29%20%7B%0D%0A%09%09%09%09range%20%3D%20work-%3Efront%28%29%3B%0D%0A%09%09%09%09work-%3Epop%28%29%3B%0D%0A%09%09%09%7D%20else%20%7B%0D%0A%09%09%09%09return%3B%0D%0A%09%09%09%7D%0D%0A%09%09%7D%0D%0A%09%09%0D%0A%09%09%2F%2F%20compute%20collatz%20number%0D%0A%09%09for%28long%20i%20%3D%20range.first%3B%20i%20%3C%20range.second%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09%09collatz_numbers%5Bi%5D%20%3D%20collatz_count%28i%2B1%29%3B%0D%0A%09%09%7D%0D%0A%09%7D%0D%0A%7D%0D%0A%0D%0Avoid%20foo%28%29%20%7B%0D%0A%09std%3A%3Aqueue%3Cstd%3A%3Apair%3Clong%2C%20long%3E%20%3E%20work%3B%0D%0A%09std%3A%3Amutex%20lock%3B%0D%0A%09%0D%0A%09long%20collatz_numbers%5BMAX_COUNT%5D%3B%0D%0A%09%0D%0A%09const%20long%20interval%20%3D%201000%3B%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%2Finterval%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09work.push%28std%3A%3Apair%3Clong%2Clong%3E%28i%2Ainterval%2C%20%28i%2B1%29%2Ainterval%29%29%3B%0D%0A%09%7D%0D%0A%09%0D%0A%09std%3A%3Athread%20t1%28do_work%2C%20collatz_numbers%2C%20%26work%2C%20%26lock%29%3B%0D%0A%09std%3A%3Athread%20t2%28do_work%2C%20collatz_numbers%2C%20%26work%2C%20%26lock%29%3B%0D%0A%09std%3A%3Athread%20t3%28do_work%2C%20collatz_numbers%2C%20%26work%2C%20%26lock%29%3B%0D%0A%09do_work%28collatz_numbers%2C%20%26work%2C%20%26lock%29%3B%0D%0A%09t1.join%28%29%3B%0D%0A%09t2.join%28%29%3B%0D%0A%09t3.join%28%29%3B%0D%0A%09%0D%0A%09%2F%2Ffor%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%2F%2F%09std%3A%3Acout%20%3C%3C%20%28i%2B1%29%20%3C%3C%20%22%3A%20%22%20%3C%3C%20collatz_numbers%5Bi%5D%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%2F%2F%7D%0D%0A%7D&lang=C%2B%2B17&mach=skylake64&mode=file&input=&linkwith=&foo_ret=void&foo_arg0=void&orun=Run&orun=Grade&orun=Time&ocompile=Optimize&ocompile=Warnings)

 - [Collatz with OpenMP](https://lawlor.cs.uaf.edu/netrun/run?name=example_cpp&code=enum%20%7B%20MAX_COUNT%20%3D%20100000%20%7D%3B%0D%0A%0D%0Along%20collatz_count%28long%20n%29%20%7B%0D%0A%09long%20count%20%3D%200%3B%0D%0A%09while%28n%20%21%3D%201%29%20%7B%0D%0A%09%09if%28n%20%25%202%20%3D%3D%200%29%20%7B%0D%0A%09%09%09n%20%3D%20n%20%2F%202%3B%0D%0A%09%09%7D%20else%20%7B%0D%0A%09%09%09n%20%3D%203%20%2A%20n%20%2B%201%3B%0D%0A%09%09%7D%0D%0A%09%09%2B%2Bcount%3B%0D%0A%09%7D%0D%0A%09return%20count%3B%0D%0A%7D%0D%0A%0D%0Along%20collatz_numbers%5BMAX_COUNT%5D%3B%0D%0A%0D%0Avoid%20foo%28%29%20%7B%0D%0A%09%23pragma%20omp%20parallel%20for%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09collatz_numbers%5Bi%5D%20%3D%20collatz_count%28i%2B1%29%3B%0D%0A%09%7D%0D%0A%09%2F%2Ffor%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%2F%2F%09std%3A%3Acout%20%3C%3C%20%28i%2B1%29%20%3C%3C%20%22%3A%20%22%20%3C%3C%20collatz_numbers%5Bi%5D%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%2F%2F%7D%0D%0A%7D&lang=C%2B%2B17&mach=skylake64&mode=file&input=&linkwith=&foo_ret=void&foo_arg0=void&orun=Run&orun=Grade&orun=Time&ocompile=Optimize&ocompile=Warnings)

 - [Collatz sum with OpenMP reduction](https://lawlor.cs.uaf.edu/netrun/run?name=example_cpp&code=enum%20%7B%20MAX_COUNT%20%3D%20100000%20%7D%3B%0D%0A%0D%0Along%20collatz_count%28long%20n%29%20%7B%0D%0A%09long%20count%20%3D%200%3B%0D%0A%09while%28n%20%21%3D%201%29%20%7B%0D%0A%09%09if%28n%20%25%202%20%3D%3D%200%29%20%7B%0D%0A%09%09%09n%20%3D%20n%20%2F%202%3B%0D%0A%09%09%7D%20else%20%7B%0D%0A%09%09%09n%20%3D%203%20%2A%20n%20%2B%201%3B%0D%0A%09%09%7D%0D%0A%09%09%2B%2Bcount%3B%0D%0A%09%7D%0D%0A%09return%20count%3B%0D%0A%7D%0D%0A%0D%0Along%20collatz_numbers%5BMAX_COUNT%5D%3B%0D%0A%0D%0Along%20foo%28%29%20%7B%0D%0A%09long%20sum%20%3D%200%3B%0D%0A%09%23pragma%20omp%20parallel%20for%20reduction%28%2B%3Asum%29%0D%0A%09for%28long%20i%20%3D%200%3B%20i%20%3C%20MAX_COUNT%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09sum%20%2B%3D%20collatz_count%28i%2B1%29%3B%0D%0A%09%7D%0D%0A%09return%20sum%3B%0D%0A%7D&lang=C%2B%2B17&mach=skylake64&mode=file&input=&linkwith=&foo_ret=long&foo_arg0=void&orun=Run&orun=Grade&orun=Time&ocompile=Optimize&ocompile=Warnings)

 - [Bank transfer lock/deadlock example](https://lawlor.cs.uaf.edu/netrun/run?name=Testing&code=%23include%20%3Cthread%3E%0D%0A%23include%20%3Cvector%3E%0D%0A%23include%20%3Cqueue%3E%0D%0A%23include%20%3Cmutex%3E%0D%0A%23include%20%3Cfunctional%3E%0D%0A%0D%0Astruct%20transfer%20%7B%0D%0A%09transfer%28%29%3A%20amount%280%29%2C%20source%280%29%2C%20dest%280%29%20%7B%7D%0D%0A%09transfer%28unsigned%20long%20a%2C%20unsigned%20long%20s%2C%20unsigned%20long%20d%29%20%3A%0D%0A%09%09amount%28a%29%2C%20source%28s%29%2C%20dest%28d%29%20%7B%7D%0D%0A%0D%0A%09unsigned%20long%20amount%3B%0D%0A%09unsigned%20long%20source%3B%0D%0A%09unsigned%20long%20dest%3B%0D%0A%7D%3B%0D%0A%0D%0Astruct%20account%20%7B%0D%0A%09account%28%29%3A%20balance%280%29%20%7B%7D%0D%0A%09account%28unsigned%20long%20b%29%20%3A%20balance%28b%29%20%7B%7D%0D%0A%0D%0A%09unsigned%20long%20balance%3B%0D%0A%09std%3A%3Amutex%20lock%3B%0D%0A%7D%3B%0D%0A%0D%0Aclass%20bank%20%7B%0D%0Apublic%3A%0D%0A%09void%20set_balance%28unsigned%20long%20acct%2C%20unsigned%20long%20balance%29%20%7B%0D%0A%09%09m_accounts%5Bacct%5D.balance%20%3D%20balance%3B%0D%0A%09%7D%0D%0A%09%0D%0A%09void%20request_transfer%28unsigned%20long%20amount%2C%20unsigned%20long%20source%2C%20unsigned%20long%20dest%29%20%7B%0D%0A%09%09std%3A%3Alock_guard%3Cstd%3A%3Amutex%3E%20guard%28m_work_lock%29%3B%0D%0A%09%09m_work.emplace%28amount%2C%20source%2C%20dest%29%3B%0D%0A%09%7D%0D%0A%0D%0A%09void%20process_transfers%28%29%20%7B%0D%0A%09%09while%281%29%20%7B%0D%0A%09%09%09transfer%20t%3B%0D%0A%09%09%09%7B%0D%0A%09%09%09%09std%3A%3Alock_guard%3Cstd%3A%3Amutex%3E%20guard%28m_work_lock%29%3B%0D%0A%09%09%09%09if%28%21m_work.empty%28%29%29%20%7B%0D%0A%09%09%09%09%09t%20%3D%20m_work.front%28%29%3B%0D%0A%09%09%09%09%09m_work.pop%28%29%3B%0D%0A%09%09%09%09%7D%20else%20%7B%0D%0A%09%09%09%09%09return%3B%0D%0A%09%09%09%09%7D%0D%0A%09%09%09%7D%0D%0A%09%09%09%0D%0A%09%09%09this-%3Emake_transfer%28t%29%3B%0D%0A%09%09%7D%0D%0A%09%7D%0D%0A%09%0D%0A%09void%20print_balances%28%29%20%7B%0D%0A%09%09for%28std%3A%3Asize_t%20i%20%3D%200%3B%20i%20%3C%20m_accounts.size%28%29%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09%09std%3A%3Acout%20%3C%3C%20%22Account%20%22%20%3C%3C%20i%20%3C%3C%20%22%20has%20balance%20%22%20%3C%3C%20m_accounts%5Bi%5D.balance%20%3C%3C%20%22%5Cn%22%3B%0D%0A%09%09%7D%0D%0A%09%7D%0D%0Aprivate%3A%0D%0A%09void%20make_transfer%28const%20transfer%26%20t%29%20%7B%0D%0A%09%09%2F%2F%20Try%20using%20separate%20lock_guards%20as%20below%20%28can%20result%20in%20deadlock%29%0D%0A%09%09%2F%2F%20%20%20%20%20or%20using%20few%20guards%20%28can%20result%20in%20creating%2Flosing%20money%29%0D%0A%09%09%2F%2F%0D%0A%09%09%2F%2F%20std%3A%3Alock_guard%3Cstd%3A%3Amutex%3E%20source_guard%28m_accounts%5Bt.source%5D.lock%29%3B%0D%0A%09%09%2F%2F%20std%3A%3Alock_guard%3Cstd%3A%3Amutex%3E%20dest_guard%28m_accounts%5Bt.dest%5D.lock%29%3B%0D%0A%09%09std%3A%3Ascoped_lock%20source_guard%28%0D%0A%09%09%09%09m_accounts%5Bt.source%5D.lock%2C%0D%0A%09%09%09%09m_accounts%5Bt.dest%5D.lock%0D%0A%09%09%09%29%3B%0D%0A%09%09if%28m_accounts%5Bt.source%5D.balance%20%3E%3D%20t.amount%29%20%7B%0D%0A%09%09%09m_accounts%5Bt.source%5D.balance%20-%3D%20t.amount%3B%0D%0A%09%09%09m_accounts%5Bt.dest%5D.balance%20%2B%3D%20t.amount%3B%0D%0A%09%09%7D%0D%0A%09%7D%0D%0A%09%0D%0A%09std%3A%3Aarray%3Caccount%2C%203%3E%20m_accounts%3B%0D%0A%09%0D%0A%09std%3A%3Aqueue%3Ctransfer%3E%20m_work%3B%0D%0A%09std%3A%3Amutex%20m_work_lock%3B%0D%0A%7D%3B%0D%0A%0D%0Avoid%20foo%28%29%20%7B%0D%0A%09bank%20b%3B%0D%0A%09b.set_balance%280%2C%20100%29%3B%0D%0A%09b.set_balance%281%2C%20100%29%3B%0D%0A%09b.set_balance%282%2C%20100%29%3B%0D%0A%09%0D%0A%09for%28unsigned%20long%20i%20%3D%200%3B%20i%20%3C%2010000%3B%20%2B%2Bi%29%20%7B%0D%0A%09%09b.request_transfer%2840%2C%20i%253%2C%20%28i%2B1%29%253%29%3B%0D%0A%09%09b.request_transfer%2830%2C%20i%253%2C%20%28i%2B2%29%253%29%3B%0D%0A%09%7D%0D%0A%09%0D%0A%09std%3A%3Athread%20t1%28std%3A%3Abind%28%26bank%3A%3Aprocess_transfers%2C%20%26b%29%29%3B%0D%0A%09std%3A%3Athread%20t2%28std%3A%3Abind%28%26bank%3A%3Aprocess_transfers%2C%20%26b%29%29%3B%0D%0A%09std%3A%3Athread%20t3%28std%3A%3Abind%28%26bank%3A%3Aprocess_transfers%2C%20%26b%29%29%3B%0D%0A%0D%0A%09b.process_transfers%28%29%3B%0D%0A%0D%0A%09t1.join%28%29%3B%0D%0A%09t2.join%28%29%3B%0D%0A%09t3.join%28%29%3B%0D%0A%0D%0A%09b.print_balances%28%29%3B%0D%0A%09return%3B%0D%0A%7D&lang=C%2B%2B17&mach=skylake64&mode=file&input=&linkwith=&foo_ret=void&foo_arg0=void&orun=Run&orun=Grade&ocompile=Optimize&ocompile=Warnings)

 - [Big timing comparison example](https://github.com/permutationlock/cs301_fall_2021/tree/main/cpp_threading)

